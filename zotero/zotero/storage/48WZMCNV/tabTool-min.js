var LOC=window.location,CHANNEL_ID="unknown",NEW_EXTENSION=window.mozCNChannel?true:false,DOMAIN_TOP=document.domain.split(".").slice(-2).join(".");ROOT=LOC.protocol+"//"+LOC.hostname+(LOC.pathname.replace(/\/$/,"")),IFRAME_DATA={};var MOZ_INFO={TIME_OUT:10000,OVER_TIME:300,SYSTEM_IS_BUSY:"系统繁忙，请稍后再试",DEFAULT_COOKIE_EXPIRE:new Date("December 31, 2100"),FETCH_CITY_FAILED:"获取城市信息失败",OPERATE_STR:"<div class='loading'><span>正在操作，请耐心等候...</span></div>",SECRET_MODE:"您开启了【秘密浏览】模式，可能导致某些功能无法正常使用",MOZ_PRODUCE:"火狐出品",FAN_PRODUCE:"粉丝提供"};(function(){var a={__backend__:{setItem:function(d,f,b){var c;if(b){c=new Date();c.setTime(b)}else{c=MOZ_INFO.DEFAULT_COOKIE_EXPIRE}try{document.cookie=d+"="+escape(f+"")+"; path=/; domain="+DOMAIN_TOP+"; expires="+c.toGMTString()}catch(g){}},getItem:function(g,c){var b=(c!=undefined?c:undefined);try{var d=document.cookie.split(";"),h=new RegExp("^ ?"+g+"="),f;for(f in d){if(h.test(d[f])){var k=d[f];b=unescape(k.substr(k.indexOf("=")+1))}}}catch(j){}return b}},getItem:function(c,f){var b=null;try{b=this.__backend__.getItem(c);if(b!==null){b=JSON.parse(b+"")||f}else{b=f}}catch(e){b=f}return b},setItem:function(d,c,b){try{this.__backend__.setItem(d,JSON.stringify(c),b)}catch(e){}}};if(!window.CookieWidget){window.CookieWidget=a}})();(function(){var b={__backend__:null,storeList:{},init:function(){var d=this;if(window.localStorage){try{d.__backend__=window.localStorage;d.__backend__.__type__="ls"}catch(f){c(MOZ_INFO.SECRET_MODE)}}else{if(window.globalStorage){try{d.__backend__=window.globalStorage;d.__backend__.__type__="gs"}catch(f){c(MOZ_INFO.SECRET_MODE)}}else{if(document.cookie){try{d.__backend__=CookieWidget.__backend__;d.__backend__.__type__="ck"}catch(f){c(MOZ_INFO.SECRET_MODE)}}else{this.backend={getItem:function(){return null},setItem:function(){},__type__:"dummy"}}}}},getItem:function(f,h){var e=null;try{e=this.__backend__.getItem(f);if(e!==null){e=JSON.parse(e+"")||h}else{e=h}}catch(g){e=h}return e},setItem:function(f,e,d){var h=this;try{h.__backend__.setItem(f,JSON.stringify(e));h.storeList[f]=1}catch(g){}},clear:function(){var d=this,e=d.storeList;var f=b.getItem("n_s_version");if(f!=__version__){if(__clears__&&__clears__.length){$.each(__clears__,function(i,g){d.setItem(g,"")})}else{$.each(e,function(g,h){d.setItem(g,"")})}CookieWidget.setItem("n_user_data","");d.setItem("n_s_version",__version__)}}};var a=$("#system-error");function c(d){d&&a.html(d).show()}b.init();if(!window.StorageWidget){window.StorageWidget=b}})();(function(){var a=(function(){var g=navigator.userAgent;var l=function(){};l.escapeHtml=function(m){return f(m)};l.isBrowser=function(m){return i(m)};l.loadChargeSetting=function(){var n=$("#iframe-charge");if(!n.length){return}var m=n.attr("data-url"),p="skin="+IFRAME_DATA.skin+"&ver="+IFRAME_DATA.ver,o=m+"#"+p;n.attr("src",o);n.get(0).contentWindow.location.reload()};l.checkLogin=function(){var m=CookieWidget.getItem("n_user_data"),n=false;if(m&&m.uname){n=true}return n};l.getRepairURL=function(){return getPageRepair()};l.loadDelayResource=function(m){if(m&&m.length){$.each(m,function(p,q){var o=$(q);k(o)})}else{k(m)}};l.getParam=function(m){var r=null,u=window.location.search;if(u){var s=u.substr(1),p=s.split("&"),n=0,q=p.length;for(;n<q;n++){var t=p[n],o=t.split("=");if(o.length){if(o[0]==m){return o[1]}}}}return r};function k(p){if(p&&p.length&&p.attr("loaded")){return}var o="img-load-delay",n="iframe-load-delay",q=p?p.find("."+o):$("."+o),m=p?p.find("."+n):$("."+n);if(p&&p.length&&(!m.length&&!q.length)){p.attr("loaded","loaded")}if(q.length){$.each(q,function(r,s){j($(s),o)})}if(m.length){$.each(m,function(s,r){j($(r),n)})}}function j(n,m){if(!n.length){return}var o=n.attr("data-url");o&&n.attr("src",o+"?v="+new Date().getTime());if(o){n.on("load",function(p){n.removeClass(m);n.removeAttr("data-url")})}}function f(m){if(!m){return""}return(m+"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&apos;").replace(/\"/g,"&quot;").replace(/\s/g,"&nbsp;").replace(/\(/g,"（").replace(/\)/g,"）")}function i(n){var m="",o=e();if(d()){var p=h();if(p){m=p}else{m=b();m=m?m:o}}else{m=o}return n?(n.toLowerCase()==m.toLowerCase()):m}function d(){var m=0,r="MSIE|like Gecko",o=r.split("|"),q=o.length,n=false;for(;m<q;m++){var p=o[m];if(g.indexOf(p)>-1){n=true;break}}return n}function e(){var p=0,r="Firefox|MSIE|Chrome|Safari|Opera",m=r.split("|"),o=m.length,q="";for(;p<o;p++){var n=m[p];if(g.indexOf(n)>-1){q=n;break}}return q}function h(){var r=0,q="QQBrowser|BIDUBrowser|Maxthon|LBBROWSER|360SE|SE",m=q.split("|"),p=m.length,o="";for(;r<p;r++){var n=m[r];if(g.indexOf(n)>-1){o=n;break}}return o}function b(){var n="";if(g.indexOf("360SE")>-1){n="360IE"}else{var n="";if(c()){n="360SE"}else{var m="track" in document.createElement("track"),o="scoped" in document.createElement("style"),p="v8Locale" in window;if(m&&o&&p){n="360SE"}else{if(m&&o&&!p){n="360JS"}}}}return n}function c(){var o=g.indexOf("360chrome")>-1?true:false,n;try{window.external&&window.external.twGetRunPath&&(n=window.external.twGetRunPath)&&g.indexOf("360se")>-1&&(o=true)}catch(m){o=false}return o}return l})();if(!window.MozillaTool){window.MozillaTool=a}})();(function(){var a=(function(){var h="normal";var b=function(){};b.loadChannel=function(){c()};b.build=function(j,i){i&&(h=i);$(document).on("click","a",function(k){g($(this))});$(document).on("submit","form",function(s){var m=$(this),k=m.find(".engine-key"),n=m.find(".engine-key-hidden"),q=k.val()||"无关键字",l=m.attr("trace-url"),r=m.attr("trace-key");if(k.length&&n.length){n.val(k.val());k.val("")}if(m.hasClass("engine-trace-form")){var o=m.attr("action"),p=$.trim(m.find(".engine-type").val());l=o+"?q="+q+"&engine="+p}m.attr({"trace-title":q,"trace-url":l});f(q,l,r)})};b.addLinkTrace=function(i){g($(i))};b.addTrace=function(l,i,k,j,m){f(l,i,k,j,m)};var d={};b.addDisplayTrace=function(m,p,i,k){var j=new Date(),n=j.getFullYear()+"-"+(j.getMonth()+1)+"-"+j.getDate(),o=StorageWidget.getItem("n_dp_data",d),l=o;if(o.time!=n){l={};l.time=n;l[m]=1}else{if(!o[m]){l[m]=1}else{return}}d=l;f(p,i,k);StorageWidget.setItem("n_dp_data",l)};function g(m,o){var n=m.attr("title")||m.text(),j=m.attr("href")||"javascript:;",i=$.trim(m.attr("trace-key")),l=i?i:undefined;if(!l){var k=m.parents("[trace-key]").eq(0);l=k.length?(k.attr("trace-key")||"other_unknown"):undefined}f(n,j,l,m,o)}function f(n,i,k,j,p){var i=$.trim(i),n=$.trim(n)||"无关键字",k=$.trim(k)||"other_unknown",m=new Image(),o=CHANNEL_ID;if(h=="newTab"){if(window.parent){try{window.parent.postMessage(JSON.stringify({sid:k,title:n,href:i,altBase:"http://newtab.firefoxchina.cn/img/trace.gif"}),"http://offlintab.firefoxchina.cn")}catch(l){}}}else{if(i){m.src="img/trace.gif?r="+Math.random()+"&d="+encodeURIComponent(document.location.host)+"&c="+encodeURIComponent(k)+"&a="+encodeURIComponent("")+"&u="+encodeURIComponent(i)+"&cid="+encodeURIComponent(o)+"&t="+encodeURIComponent(n)}}}function e(k,i){var k=$(k),j=$(k).get(0).tagName.toLowerCase();switch(j){case"form":k.submit();break;default:window.top.href=i;break}}function c(){if(NEW_EXTENSION){var j=new window.CustomEvent("WebChannelMessageToChrome",{detail:{id:window.mozCNChannel,message:{id:5,key:"startup.channelid"}}});window.dispatchEvent(j)}else{if(window.cehomepage||window.mozCNUtils){try{if(window.cehomepage){var k=window.cehomepage.startup;if(!k.channelid){CHANNEL_ID="unknown"}else{CHANNEL_ID=k.channelid()}}}catch(i){CHANNEL_ID="unknown"}}}}return b})();if(!window.TraceWidget){window.TraceWidget=a}})();(function(){var e=[],f=[];var b=function(i){};b.build=function(i){var j=$(i);$.each(j,function(p,s){var m=s,l=$(m),r=l.next(),q=l.find("li"),o=l.attr("switch-type"),k=o?o.toLowerCase():"mouseover";if(r.length){r.mouseenter(function(t){t.stopPropagation();var v=$(this),u=l.attr("minterval");if(!u){v.off("mouseenter");return}if(r.attr("oit")!=undefined){return}h("cont");v.attr("overTime",(new Date().getTime()));var n=setInterval(function(){var w=new Date().getTime(),y=parseInt(v.attr("overTime"))||w,x=Math.abs(w-y);if(x>=MOZ_INFO.OVER_TIME){h("cont");clearInterval(parseInt(u));l.removeAttr("minterval")}},10);r.attr("oit",n);f.push(n)});r.mouseleave(function(n){n.stopPropagation();if(l.attr("minterval")==undefined){$(this).off("mouseleave");return}$(this).removeAttr("oit")})}if(k=="mouseover"){q.mouseenter(function(t){t.stopPropagation();var u=$(this);if(u.attr("oit")!=undefined){return}h("menu");u.attr("overTime",new Date().getTime()).siblings().removeAttr("overTime");var n=setInterval(function(){if(u.attr("oit")==undefined){h("menu");return}var v=new Date().getTime(),y=parseInt(u.attr("overTime"))||v,x=Math.abs(v-y);if(x>=MOZ_INFO.OVER_TIME){var w=l.attr("minterval");if(w){clearInterval(parseInt(w));l.removeAttr("minterval")}h("menu");d(u)}},10);u.attr("oit",n).siblings().removeAttr("oit");e.push(n)});q.mouseleave(function(n){n.stopPropagation();var t=$(this);t.removeAttr("oit")})}else{q.on(k,function(n){n.stopPropagation();var t=$(this);d(t)})}})};b.randSwitch=function(i){var j=$(i);$.each(j,function(D,B){var F=B,l=$(F),k=l.find("li[no-random='']"),p=k.length,z=Math.random(),C=10,E=z*C;if(p>1){var v=[],m=0,A=0;for(var D=0;D<p;D++){var x=k.eq(D),u=$.trim(x.attr("rand-per")),t=0;if(u){t=parseFloat(u),F=m+t;if(F>1){t=1-m>0?1-m:0;m=1}else{m=F}}else{t=0}if(t==0){A++}v.push(t)}var r=m<1?((1-m)>0?(1-m)/A:0):0,w=[],o=0,y=0;for(var q=0;q<p;q++){var F=v[q],x=k.eq(q),s=F>0?F:r,o=o+s*C;w.push(o)}while(E>w[y]&&y<p){y++}d(k.eq(y))}else{k=l.find("li");k.length&&d(k.eq(Math.floor(z*k.length)))}})};b.autoSwitch=function(i){var j=$(i);$.each(j,function(m,s){var l=s,k=$(s),p=k.attr("data-auto");if(p){var r=k.find("li[auto-enabled]"),q=r.length;k.removeAttr("data-auto");var o=setInterval(function(){var u=r.filter(".on"),t=r.index(u),n=(t+1>q-1)?0:t+1;d(r.eq(n))},10000);k.attr("minterval",o)}})};b.loadTour=function(i,j,k){a(i,j,k)};function d(j){if(!j||(j.size()&&j.hasClass("on"))){return}var k=j.attr("for");if(!k){return}j.addClass("on").siblings().removeClass("on");var i=k.split(",");$.each(i,function(n,l){var p=$.trim(l);if(p){var o=$("#"+p);if(o.length){o.show().siblings().hide();MozillaTool.loadDelayResource(o);if(j.attr("data-loaded")){return}}}})}function h(k){var j=[];switch(k){case"menu":j=e;e=[];break;case"cont":j=f;f=[];break}if(j.length){var l=0,i=j.length;for(;l<=i;l++){clearInterval(j[l])}}}function a(i,k,j){$.ajax({url:"http://open.tuniu.com/distributor/product/firefox-new/index2.php?t="+new Date().getTime(),type:"get",dataType:"jsonp",timeout:MOZ_INFO.TIME_OUT,error:function(){k.html("<div class='error'>"+MOZ_INFO.SYSTEM_IS_BUSY+"</div>")},success:function(n){var l=n?n.status:0,m=MOZ_INFO.SYSTEM_IS_BUSY;if(l==1){i.length&&i.attr("data-loaded",1);m=c(n);k.html(m);j&&j.call(null)}}})}function c(l){var o="";if(l){var n=l.position1,m=l.position2,j=l.position3,q=l.position4,p=l.position5,r=2,k=6;o="<div class='hot-mod hot-top'><div class='hot-left'><ul>";if(n&&n.items){var i=n.items;o+=" <li class='hot-img-one'>   <div>       <a class='news-img-wrapper' href='"+i.url+"' title='"+i.title+"'>         <img src='"+i.imgurl+"'/>       </a>       <p class='img-text'><a href='"+i.url+"' title='"+i.title+"'>"+i.title+"</a></p>    </div></li>"}o+="<li class='hot-img-two'>";if(m&&m.items.length){$.each(m.items,function(s,t){if(s<r){o+=" <div class='"+(s==0?"img-two-left":"img-two-right")+"'>      <a class='news-img-wrapper' href='"+t.url+"' title='"+t.title+"'>       <img src='"+t.imgurl+"'/>    </a>    <p class='img-text'><a href='"+t.url+"' title='"+t.title+"'>"+t.title+"</a></p> </div>"}})}o+="</li>";o+="</ul></div><div class='hot-right'>";o+=" <ul class='item-list right-top'>";if(j&&j.items){$.each(j.items,function(s,t){if(s<2*k){if(s==k){o+="</ul><ul class='item-list'>"}o+=" <li"+(s==0?" class='first'":"")+"><a href='"+t.url+"' title='"+t.title+"'>"+t.title+"</a></li>"}})}o+=" </ul></div></div>";o+="<div class='hot-mod hot-bottom'><div class='hot-left'>"+g(q.items)+"</div>";o+="<div class='hot-right'>"+g(p.items)+"</div>";o+="</div></div>"}return o}function g(l){var i="",j=6;if(l&&l.length){var k=l[0];i+="<div class='hot-mod-inner hot-bottom-img'><a class='news-img-wrapper' href='"+k.url+"' title='"+k.title+"'><img src='"+k.imgurl+"'/></a><div class='hot-bottom-imginfo'>    <a href='"+k.url+"' class='first bom-img-text' title='"+k.title+"'>"+k.title+"</a>    <p><a href='"+k.url+"' title='"+(k.intro?k.intro:k.title)+"'>"+(k.intro?k.intro:k.title)+"</a></p></div></div>";i+="<div class='hot-mod-inner hot-bottom-list'><ul class='item-list hot-list'>";$.each(l,function(m,o){if(m>0&&m<=j){i+="<li><a href='"+o.url+"' title='"+o.title+"'>"+o.title+"</a></li>"}});i+="</ul></div>"}return i}if(!window.TabWidget){window.TabWidget=b}})();